# SmartRPA Background Service

## é¡¹ç›®ç®€ä»‹

SmartRPA Background Service æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘é¡µè‡ªåŠ¨åŒ–å’Œæ•°æ®é‡‡é›†å¹³å°ï¼Œèƒ½å¤Ÿåœ¨å¤šä¸ªç”µå•†ç½‘ç«™å’Œå¹³å°ä¸Šæ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ•°æ®çˆ¬å–ã€ä¿¡æ¯æå–å’Œè‡ªåŠ¨åŒ–æ“ä½œã€‚

## ğŸ“– æ–‡æ¡£å¯¼èˆª

- **ğŸ‘€ [é¡¹ç›®æ¦‚è§ˆ](./é¡¹ç›®æ¦‚è§ˆ.md)** - ä¸€é¡µäº†è§£é¡¹ç›®å…¨è²Œ
- **ğŸš€ [å¿«é€Ÿå…¥é—¨æŒ‡å—](./å¿«é€Ÿå…¥é—¨.md)** - 3åˆ†é’Ÿå¿«é€Ÿä½“éªŒï¼Œé€‚åˆæ–°æ‰‹
- **ğŸ“‹ [è¯¦ç»†é¡¹ç›®è¯´æ˜](./é¡¹ç›®è¯´æ˜.md)** - å®Œæ•´åŠŸèƒ½ä»‹ç»å’Œä½¿ç”¨æŒ‡å—
- **â“ [å¸¸è§é—®é¢˜FAQ](./FAQ.md)** - å¸¸è§é—®é¢˜è§£ç­”å’Œæ•…éšœæ’é™¤
- **ğŸ—ï¸ [ç³»ç»Ÿæ¶æ„](./ARCHITECTURE.md)** - æŠ€æœ¯æ¶æ„å’Œè®¾è®¡åŸç†
- **ğŸ”Œ [APIå‚è€ƒ](./API_REFERENCE.md)** - å®Œæ•´APIæ¥å£æ–‡æ¡£
- **âš™ï¸ [ä»»åŠ¡æ‰§è¡Œå™¨](./TASK_EXECUTORS.md)** - æ‰©å±•å¼€å‘æŒ‡å—

## æ ¸å¿ƒç‰¹æ€§

- ğŸŒ **å¤šå¹³å°æ”¯æŒ**: OZONã€Amazonã€äº¬ä¸œã€ç¾å›¢ã€å°çº¢ä¹¦ç­‰
- ğŸ¤– **æ™ºèƒ½è‡ªåŠ¨åŒ–**: Cookieç®¡ç†ã€AdsPoweræµè§ˆå™¨æŒ‡çº¹ã€åæ£€æµ‹
- ğŸ“Š **æ•°æ®å¤„ç†**: å¤šæ ¼å¼è¾“å‡ºã€äº‘å­˜å‚¨é›†æˆã€å®æ—¶æ¸…æ´—
- ğŸ”„ **ä»»åŠ¡ç®¡ç†**: å¹¶å‘å¤„ç†ã€é˜Ÿåˆ—ç®¡ç†ã€å¤±è´¥é‡è¯•
- â˜ï¸ **äº‘ç«¯éƒ¨ç½²**: Dockerã€AWSã€Google Cloudæ”¯æŒ

## å®‰è£…ä¸è®¾ç½®

### å‰ç½®æ¡ä»¶
- Node.js v14+
- npm æˆ– pnpm
- Docker (å¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²)

### å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ npm
npm install

# æˆ–ä½¿ç”¨ pnpm
pnpm install
```

### é…ç½®
1. åˆ›å»ºå¹¶è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„é…ç½®å‚æ•°
```
# æœåŠ¡å™¨é…ç½®
PORT=8082

# AWS é…ç½® (ç”¨äºS3å­˜å‚¨)
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_REGION=ap-southeast-2
S3_BUCKET_NAME=your_bucket_name

# å…¶ä»–é…ç½®
ENVIRONMENT=local  # æˆ– cloud
```

## è¿è¡ŒæœåŠ¡

### å¼€å‘æ¨¡å¼
```bash
node server.js
```

### åå°è¿è¡Œ
```bash
nohup node server.js > server.log 2>&1 &
```

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t smartrpa-background .

# è¿è¡Œå®¹å™¨
docker run -p 8082:8082 -d smartrpa-background
```

## API ä½¿ç”¨è¯´æ˜

### æäº¤ä»»åŠ¡ (å¼‚æ­¥å¤„ç†)
```
POST /scrape
Content-Type: application/json

{
  "taskId": "task123",
  "taskName": "ozon_data_collection",
  "sortedData": [...],
  "row": {...}
}
```

### æäº¤ä»»åŠ¡ (åŒæ­¥å¤„ç†)
```
POST /scrape_dengdai
Content-Type: application/json

{
  "taskId": "task123",
  "taskName": "ozon_data_collection",
  "sortedData": [...],
  "row": {...}
}
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
```
GET /task-status?id=task123
```

### å¿ƒè·³æ£€æµ‹
```
GET /heartbeat?id=task123
```

### å–æ¶ˆä»»åŠ¡
```
POST /cancel-task
Content-Type: application/json

{
  "taskId": "task123"
}
```

## ä»»åŠ¡ç®¡ç†å·¥ä½œæµ

ä»»åŠ¡ç®¡ç†APIæœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„ç«¯å£ï¼ˆé»˜è®¤8083ï¼‰:

```bash
# å¯åŠ¨ä»»åŠ¡ç®¡ç†API
node task_manager_api.js
```

é€šè¿‡æ­¤APIå¯ä»¥ç®¡ç†å·¥ä½œæµå®šä¹‰å’Œä»»åŠ¡æ‰§è¡Œã€‚

## ç›‘æ§ä¸ç»´æŠ¤

- ä½¿ç”¨ `monitor.sh` è„šæœ¬ç›‘æ§æœåŠ¡çŠ¶æ€
- æ—¥å¿—æ–‡ä»¶ä½äº `server.log`
- å®šæœŸæ£€æŸ¥ `/tasks` ç«¯ç‚¹äº†è§£å½“å‰è¿è¡Œå’Œå·²å®Œæˆä»»åŠ¡

## ç³»ç»Ÿè¦æ±‚

- CPU: 2æ ¸æˆ–ä»¥ä¸Š
- å†…å­˜: æœ€ä½4GBï¼Œæ¨è8GBä»¥ä¸Š
- å­˜å‚¨: æœ€ä½10GBå¯ç”¨ç©ºé—´
- ç½‘ç»œ: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

## è®¸å¯è¯

ç§æœ‰è½¯ä»¶ï¼Œæœªç»è®¸å¯ä¸å¾—ä½¿ç”¨ã€å¤åˆ¶æˆ–åˆ†å‘ã€‚